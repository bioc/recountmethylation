---
title: "recountmethylation Bioconductor vignette"
author: 
  - name: Sean K. Maden
  - name: Reid F. Thompson
  - name: Kasper D. Hansen
  - name: Abhi Nellore
package: recountmethylation
date: "4/4/2020"
abstract: > 
  This is the main vignette for the `recountmethylation` package.
vignette: >
    %\VignetteDepends{RCurl}
    %\VignetteEngine{knitr::knitr} 
    %\VignetteIndexEntry{bioc_vignette} 
    %\usepackage[UTF-8]{inputenc}
output:
    BiocStyle::html_document:
        toc: true
        tocfloat: true
        code_folding: show
    pdf_document: default
---

```{r setup, include = FALSE, eval = TRUE}
library(recountmethylation)
library(HDF5Array)
knitr::opts_chunk$set(eval = TRUE,
    echo = TRUE, warning = FALSE,
    message = FALSE)
```

# Overview

DNAm assay data and sample metadata available as of March 2019 were 
piped into HDF5-based SummarizedExperiment objects about 80 to 130Gb in size.

# Server queries

Queries to `recount.bio/data` can be handled using `get_rmdl()`. Targeted data are specified by setting `which.dn`. For instance, the test dataset may be downloaded using `get_rmdl("h5se_gr", verbose = FALSE)`, which generates a new directory containing `assays.h5` and `se.rds`. For convenience, `get_rmdl` returns the filepath, and this may be used in `loadHDF5SummarizedExperiment` at the start of an analysis workflow.

Assay data are contained in the following directories:

* `remethdb_h5se_gm_00-00-01_1583780004` (class: `GenomicMethylSet`, size: 86 Gb)
* `remethdb_h5se_gr_00-00-01_1583780004` (class: `GenomicRanges`, size: 132 Gb)
* `remethdb_h5se_rg_00-00-01_1583780004` (class: `RGChannelSet`, size: 119 Gb)

# DelayedArray workflows 

Ideal workflows utilizing large DelayedArray objects will delay evaluations until absolutely necessary. In the following example, `getBeta` would not be assessed until the `summarize`.

```{r, eval = FALSE}
h5large <- loadHDF5SummarizedExperiment(h5fullsizepath)
betamatrix <- getBeta(h5large) # this is delayed 
summarize(betamatrix[,1]) # causes getBeta evaluation
```

You may consult `rm_delayedarray.Rmd` for example workflows using large DelayedArray objects. Note that not all functions are currently optimized for use with large DelayedArray objects.

# Example

For demonstration, we load the included test dataset.

```{r, testdat.dl}
testdatdn <- "remethdb_h5se-test_gr_00-00-01_1583780004"
datpath <- system.file("extdata", testdatdn, package = "recountmethylation")
h5test <- loadHDF5SummarizedExperiment(datpath)
dim(h5test)
```

Standard inspection and summaries may be used.

```{r}
# data info
class(h5test)
dim(h5test)
head(colnames(h5test))
head(rownames(h5test))
```

# Session info
```{r}
sessionInfo()
```
